name: Prevent Supabase Pause

# Ejecutar cada d√≠a a las 03:00 UTC (00:00 ART)
on:
  schedule:
    - cron: '0 3 * * *'
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install supabase client
        run: npm install @supabase/supabase-js --no-audit --no-fund

      - name: Ping Supabase (Query existing table)
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
        run: |
          node -e "
            (async () => {
              const { createClient } = require('@supabase/supabase-js');
              const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_KEY);
              
              try {
                // Opci√≥n alternativa: Query SQL directa
                const { data, error } = await supabase
                  .rpc('sql', { query: 'SELECT 1 as ping' });
                
                if (error) {
                  console.error('‚ùå Error al hacer ping:', error);
                  process.exit(1);
                }
                
                console.log('‚úÖ Supabase ha respondido correctamente');
                console.log('üìä Datos obtenidos:', data ? data.length : 0, 'registros');
              } catch (err) {
                console.error('‚ùå Error inesperado:', err);
                process.exit(1);
              }
            })();
          "